<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Condition System</title><link type="text/css" rel="stylesheet" href="public/anatomy.css" /><link type="text/css" rel="stylesheet" href="public/highlight.css" /><script type="text/javascript" src="public/jquery.js"></script><script type="text/javascript" src="public/jquery.hotkeys.js"></script><script type="text/javascript" src="public/tags_condition-system.js"></script><script type="text/javascript" src="public/main.js"></script></head><body><div id="main"><div id="content"><div class="section" id="section_condition-system"><h1 class="section_header"><a name="condition-system"></a>Condition System</h1><p></p><p>Rather than traditional exceptions, Atomy sports a condition/restart
system modeled on Common Lisp's design. The native Ruby exception handling
is available, but conditions and restarts are much more flexible.</p><p>
</p><div class="section" id="section_conditions"><h2 class="section_header"><a name="conditions"></a>Conditions</h2><div class="definition data"><p><a name="Condition"></a><a name="Error"></a><a name="SimpleError"></a><a name="ExceptionError"></a><a name="NoRestartError"></a><a name="PortError"></a><a name="EndOfFile"></a><a name="Warning"></a><a name="SimpleWarning"></a></p><div class="thumb"><pre><span class="no"><a href="condition-system.html#Condition">Condition</a></span><span class="p">:</span><span class="t">
  </span><span class="no"><a href="condition-system.html#Error">Error</a></span><span class="p">(</span><span class="vi">@backtrace</span><span class="p">)</span><span class="p">:</span><span class="t">
    </span><span class="no"><a href="condition-system.html#SimpleError">SimpleError</a></span><span class="p">(</span><span class="vi">@value</span><span class="p">)</span><span class="t">
    </span><span class="no"><a href="condition-system.html#ExceptionError">ExceptionError</a></span><span class="p">(</span><span class="vi">@exception</span><span class="p">)</span><span class="t">
    </span><span class="no"><a href="condition-system.html#NoRestartError">NoRestartError</a></span><span class="p">(</span><span class="vi">@name</span><span class="p">)</span><span class="t">
    </span><span class="no"><a href="condition-system.html#PortError">PortError</a></span><span class="p">(</span><span class="vi">@port</span><span class="p">)</span><span class="p">:</span><span class="t">
      </span><span class="no"><a href="condition-system.html#EndOfFile">EndOfFile</a></span><span class="t">
  </span><span class="no"><a href="condition-system.html#Warning">Warning</a></span><span class="p">(</span><span class="vi">@backtrace</span><span class="p">)</span><span class="p">:</span><span class="t">
    </span><span class="no"><a href="condition-system.html#SimpleWarning">SimpleWarning</a></span><span class="p">(</span><span class="vi">@value</span><span class="p">)</span></pre></div><p>Condition system hierarchy. You should subclass one of these to create
your own conditions.</p></div><div class="definition"><p><a name="name"></a></p><div class="thumb"><pre><span class="no">Condition</span><span class="t"> </span><span class="n"><a href="condition-system.html#name">name</a></span><span class="definition_result_arrow"> =&gt; </span><span class="no">String</span></pre></div><p>Get the name of a condition. By default, this will be the class name,
but you may override this for your own behaviour.</p></div><div class="definition"><p><a name="message"></a></p><div class="thumb"><pre><span class="no">Condition</span><span class="t"> </span><span class="n"><a href="condition-system.html#message">message</a></span><span class="definition_result_arrow"> =&gt; </span><span class="no">String</span></pre></div><p>A human-friendly message displayed for the condition. Override this.</p></div></div><div class="section" id="section_handling"><h2 class="section_header"><a name="handling"></a>Handling</h2><div class="definition"><p><a name="restart"></a></p><div class="thumb"><pre><span class="n"><a href="condition-system.html#restart">restart</a></span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="t"> </span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="definition_result_arrow"> =&gt; </span><span class="n">_</span>
  | <span class="n"><a href="condition-system.html#name">name</a></span><span class="t"> </span><span class="n">is-a</span><span class="p">(</span><span class="no">Symbol</span><span class="p">)</span><span class="o">?</span></pre></div><p>Invoke the <code><span class="n"><a href="condition-system.html#name">name</a></span></code> restart, passing <code><span class="n">args</span></code> along to its callback.</p><p>See <code><span class="n">with-restarts</span></code>.</p><div class="example"><p><p><em>Example:</em></p></p><div class="interaction"><pre><span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n">with-restarts</span><span class="p">(</span><span class="n">foo</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="mi">42</span><span class="p">)</span><span class="p">:</span><span class="t"> </span><span class="n"><a href="condition-system.html#signal">signal</a></span><span class="p">(</span><span class="ss">.bar</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="ss">.bar</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n"><a href="condition-system.html#restart">restart</a></span><span class="p">(</span><span class="ss">.foo</span><span class="p">)</span>
<span class="mi">42</span>
</pre></div></div></div><div class="definition macro"><div class="thumb"><pre><span class="p">{</span><span class="t"> </span><span class="si">~</span><span class="o">*</span><span class="n">body</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="si">~</span><span class="o">*</span><span class="n">handlers</span></pre></div><p>Register <code><span class="n">handlers</span></code> for various signals for the duration of <code><span class="n">body</span></code>'s
execution.</p><p>The result is the result of <code><span class="n">body</span></code>.</p><div class="example"><p><p><em>Example:</em></p></p><div class="interaction"><pre><span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="condition-system.html#signal">signal</a></span><span class="p">(</span><span class="ss">.a</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="ss">.a</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n"><a href="input-and-output.html#puts">puts</a></span><span class="p">(</span><span class="s">&quot;</span><span class="s">got A!</span><span class="s">&quot;</span><span class="p">)</span>
got A!
<span class="kc">nil</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="condition-system.html#signal">signal</a></span><span class="p">(</span><span class="ss">.b</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="ss">.a</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n"><a href="input-and-output.html#puts">puts</a></span><span class="p">(</span><span class="s">&quot;</span><span class="s">got A!</span><span class="s">&quot;</span><span class="p">)</span>
<span class="kc">nil</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="condition-system.html#signal">signal</a></span><span class="p">(</span><span class="ss">.a</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="ss">.a</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n"><a href="input-and-output.html#puts">puts</a></span><span class="p">(</span><span class="s">&quot;</span><span class="s">x</span><span class="s">&quot;</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="ss">.a</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n"><a href="input-and-output.html#puts">puts</a></span><span class="p">(</span><span class="s">&quot;</span><span class="s">y</span><span class="s">&quot;</span><span class="p">)</span>
x
y
<span class="kc">nil</span>
</pre></div></div></div><div class="definition macro"><div class="thumb"><pre><span class="n">with-restarts</span><span class="p">(</span><span class="si">~</span><span class="o">*</span><span class="n">restarts</span><span class="p">)</span><span class="p">:</span><span class="t"> </span><span class="si">~</span><span class="o">*</span><span class="n">body</span></pre></div><p>Register restarts available for the duration of <code><span class="n">body</span></code>'s execution.</p><p>The <code><span class="n">restarts</span></code> should be in the form of
<code><em>name</em>(*<em>args</em>) -&gt; <em>expr</em></code>.</p><p>The result is the result of <code><span class="n">body</span></code>.</p><div class="example"><p><p><em>Example:</em></p></p><div class="interaction"><pre><span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n">with-restarts</span><span class="p">(</span><span class="n">x</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="mi">1</span><span class="p">,</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="mi">2</span><span class="p">)</span><span class="p">:</span><span class="t"> </span><span class="n"><a href="condition-system.html#signal">signal</a></span><span class="p">(</span><span class="ss">.a</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="ss">.a</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n"><a href="condition-system.html#restart">restart</a></span><span class="p">(</span><span class="ss">.x</span><span class="p">)</span>
<span class="mi">1</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n">with-restarts</span><span class="p">(</span><span class="n">x</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="mi">1</span><span class="p">,</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="mi">2</span><span class="p">)</span><span class="p">:</span><span class="t"> </span><span class="n"><a href="condition-system.html#signal">signal</a></span><span class="p">(</span><span class="ss">.a</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="ss">.a</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n"><a href="condition-system.html#restart">restart</a></span><span class="p">(</span><span class="ss">.y</span><span class="p">)</span>
<span class="mi">2</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n">with-restarts</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n">a</span><span class="t"> </span><span class="o">*</span><span class="t"> </span><span class="mi">7</span><span class="p">)</span><span class="p">:</span><span class="t"> </span><span class="n"><a href="condition-system.html#signal">signal</a></span><span class="p">(</span><span class="ss">.a</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="ss">.a</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n"><a href="condition-system.html#restart">restart</a></span><span class="p">(</span><span class="ss">.x</span><span class="p">,</span><span class="t"> </span><span class="mi">6</span><span class="p">)</span>
<span class="mi">42</span>
</pre></div></div></div></div><div class="section" id="section_signalling"><h2 class="section_header"><a name="signalling"></a>Signalling</h2><div class="definition"><p><a name="signal"></a></p><div class="thumb"><pre><span class="n"><a href="condition-system.html#signal">signal</a></span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="definition_result_arrow"> =&gt; </span><span class="n">any</span></pre></div><p>Signal a value through all bound handlers, nearest-first, stopping when
a restart is invoked.</p><div class="example"><p><p><em>Example:</em></p></p><div class="interaction"><pre><span class="caret">&gt; </span><span class="n"><a href="condition-system.html#signal">signal</a></span><span class="p">(</span><span class="ss">.foo</span><span class="p">)</span>
<span class="kc">nil</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="condition-system.html#signal">signal</a></span><span class="p">(</span><span class="ss">.foo</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="ss">.foo</span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n"><a href="input-and-output.html#puts">puts</a></span><span class="p">(</span><span class="s">&quot;</span><span class="s">got foo</span><span class="s">&quot;</span><span class="p">)</span>
got foo
<span class="kc">nil</span>
</pre></div></div></div><div class="definition"><p><a name="error"></a></p><div class="thumb"><pre><span class="n"><a href="condition-system.html#error">error</a></span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="definition_result_arrow"> =&gt; </span><span class="n">_</span></pre></div><p>Like <code><span class="n"><a href="condition-system.html#signal">signal</a></span></code>, except that if no restart is invoked, the current
<code><span class="o">^</span><span class="n">debugger</span></code> is started.</p><p>If the given value is not an <code><span class="no"><a href="condition-system.html#Error">Error</a></span></code>, it is wrapped in a
<code><span class="no"><a href="condition-system.html#SimpleError">SimpleError</a></span></code>. If the value is a Ruby <code><span class="no">Exception</span></code>, it is wrapped
in an <code><span class="no"><a href="condition-system.html#ExceptionError">ExceptionError</a></span></code>.</p><div class="example"><p><p><em>Example:</em></p></p><div class="interaction"><pre><span class="caret">&gt; </span><span class="n"><a href="condition-system.html#error">error</a></span><span class="p">(</span><span class="s">&quot;</span><span class="s">Oh no!</span><span class="s">&quot;</span><span class="p">)</span>
<span class="gr">condition.ay::SimpleError: Oh no!</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="condition-system.html#error">error</a></span><span class="p">(</span><span class="s">&quot;</span><span class="s">Oh no!</span><span class="s">&quot;</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="no"><a href="condition-system.html#Error">Error</a></span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n"><a href="input-and-output.html#puts">puts</a></span><span class="p">(</span><span class="s">&quot;</span><span class="s">INCOMING</span><span class="s">&quot;</span><span class="p">)</span>
INCOMING
<span class="gr">condition.ay::SimpleError: Oh no!</span>
</pre></div></div></div><div class="definition"><p><a name="warning"></a></p><div class="thumb"><pre><span class="n"><a href="condition-system.html#warning">warning</a></span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="definition_result_arrow"> =&gt; </span><span class="kc">nil</span></pre></div><p>Like <code><span class="n"><a href="condition-system.html#signal">signal</a></span></code>, except that if no restart is invoked, the warning is
printed to <code><span class="o">^</span><span class="n">error-port</span></code>.</p><p>If the given value is not a <code><span class="no"><a href="condition-system.html#Warning">Warning</a></span></code>, it is wrapped in a
<code><span class="no"><a href="condition-system.html#SimpleWarning">SimpleWarning</a></span></code>. Warning messages can be muffled by binding for
<code><span class="no"><a href="condition-system.html#Warning">Warning</a></span></code> and invoking the <code><span class="ss">.muffle-warning</span></code> restart.</p><div class="example"><p><p><em>Example:</em></p></p><div class="interaction"><pre><span class="caret">&gt; </span><span class="n"><a href="condition-system.html#warning">warning</a></span><span class="p">(</span><span class="s">&quot;</span><span class="s">Suspicious!</span><span class="s">&quot;</span><span class="p">)</span>
<span class="gr">condition.ay::SimpleWarning: Suspicious!
</span><span class="kc">nil</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="condition-system.html#warning">warning</a></span><span class="p">(</span><span class="s">&quot;</span><span class="s">Quiet, you!</span><span class="s">&quot;</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n">bind</span><span class="p">:</span><span class="t"> </span><span class="no"><a href="condition-system.html#Warning">Warning</a></span><span class="t"> </span><span class="o">-&gt;</span><span class="t"> </span><span class="n"><a href="condition-system.html#restart">restart</a></span><span class="p">(</span><span class="ss">.muffle-warning</span><span class="p">)</span>
<span class="kc">nil</span>
</pre></div></div></div></div><div class="section" id="section_debuggers"><h2 class="section_header"><a name="debuggers"></a>Debuggers</h2><div class="definition data"><p><a name="DefaultDebugger"></a></p><div class="thumb"><pre><span class="no"><a href="condition-system.html#DefaultDebugger">DefaultDebugger</a></span></pre></div><p>The default debugger. This will show the condition name, its message,
and let the user pick from the available restarts.</p></div><div class="definition"><p><a name="run"></a></p><div class="thumb"><pre><span class="no">DefaultDebugger</span><span class="t"> </span><span class="n"><a href="condition-system.html#run">run</a></span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="definition_result_arrow"> =&gt; </span><span class="n">_</span></pre></div><p>Show the condition message and list the current available restarts, asking
which one to invoke.</p></div><div class="definition assign"><p><a name="Debugger"></a></p><div class="thumb"><pre><span class="no"><a href="condition-system.html#Debugger">Debugger</a></span><span class="definition_result_arrow"> = </span><span class="n">dynamic</span><span class="p">(</span><span class="no"><a href="condition-system.html#DefaultDebugger">DefaultDebugger</a></span><span class="p">)</span></pre></div><p>The current debugger. <code><span class="n"><a href="condition-system.html#run">run</a></span></code> will be called with the condition as an
argument.</p></div></div></div></div></div><div class="search"><form action="javascript:void(0)"><input type="text" placeholder="Search&hellip;" autocomplete="off" id="search" /></form><ul class="search_results"></ul></div><div id="sidebar"><h4>On this page:</h4><ol class="toc"><li><a href="condition-system.html#conditions">Conditions</a></li><li><a href="condition-system.html#handling">Handling</a></li><li><a href="condition-system.html#signalling">Signalling</a></li><li><a href="condition-system.html#debuggers">Debuggers</a></li></ol><h4>Up one level:</h4><ol class="toc"><li><a href="reference.html">Reference</a><ol><li><a href="concurrency.html">Concurrency</a><ol><li><a href="concurrency.html#sending-and-receiving">Sending &amp; Receiving</a></li><li><a href="concurrency.html#spawning">Spawning</a></li></ol></li><li><a href="condition-system.html">Condition System</a><ol><li><a href="condition-system.html#conditions">Conditions</a></li><li><a href="condition-system.html#handling">Handling</a></li><li><a href="condition-system.html#signalling">Signalling</a></li><li><a href="condition-system.html#debuggers">Debuggers</a></li></ol></li><li><a href="core.html">Core</a></li><li><a href="input-and-output.html">Input &amp; Output</a><ol><li><a href="input-and-output.html#output">Output</a></li><li><a href="input-and-output.html#input">Input</a></li></ol></li><li><a href="the-repl.html">The REPL</a></li><li><a href="therie.html">Testing with Therie</a><ol><li><a href="therie.html#structure">Structure</a></li><li><a href="therie.html#tests">Tests</a></li></ol></li></ol></li></ol></div></body></html>